<!DOCTYPE html>
<html lang="="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Themuiz AI Chat</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts: Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- ResponsiveVoice JS -->
  <script src="https://code.responsivevoice.org/responsivevoice.js?key=Negu9VLC"></script>
  <style>
    html, body {
      height: 100%;
      overflow: hidden;
    }
    @keyframes pop {
      0% { transform: scale(0.9); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    .animate-pop {
      animation: pop 0.3s ease-out;
    }
    .hide-scrollbar::-webkit-scrollbar {
      display: none;
    }
    .hide-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    .bubble strong {
      font-size: 1.1em;
      font-weight: 600;
    }
  </style>
</head>
<body class="font-inter bg-gray-950 text-gray-100 flex flex-col h-full antialiased">
  <header class="bg-gray-900 text-white p-4 text-2xl md:text-3xl font-extrabold text-center shadow-lg rounded-b-xl">
    <span class="text-blue-400">üí¨</span> Themuiz AI Chat
  </header>
  <div id="chat-box" class="flex-1 p-4 overflow-y-auto flex flex-col gap-3 bg-gray-900 rounded-xl m-4 shadow-inner hide-scrollbar"></div>
  <div id="input-area" class="flex p-4 bg-gray-900 border-t border-gray-800 items-center gap-2 shadow-lg">
    <input
      type="text"
      id="user-input"
      placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..."
      class="flex-1 p-3 border border-gray-700 rounded-full text-base outline-none bg-gray-800 text-gray-100 placeholder-gray-400 focus:ring-2 focus:ring-blue-500 transition-all duration-200"
    >
    <button
      onclick="sendMessage()"
      class="bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white p-3 rounded-full cursor-pointer font-semibold transition-colors duration-200 shadow-lg transform active:scale-95"
    >
      ‡∏™‡πà‡∏á
    </button>
  </div>

  <script>
    const chatBox = document.getElementById('chat-box');
    const input = document.getElementById('user-input');
    const apiKey = ""; // ‡πÉ‡∏™‡πà API Key ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ

    function parseMarkdownBold(text) {
      let parsedText = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
      parsedText = parsedText.replace(/\*(.*?)\*/g, '<strong>$1</strong>');
      return parsedText;
    }

    function appendBubble(text, type) {
      const div = document.createElement('div');
      div.className = `bubble ${type} p-3 rounded-xl max-w-[80%] break-words shadow-md animate-pop`;
      if (type === 'user') {
        div.classList.add('bg-blue-600', 'text-white', 'self-end', 'rounded-br-none');
      } else if (type === 'bot') {
        div.classList.add('bg-gray-800', 'text-gray-200', 'self-start', 'rounded-bl-none');
      }
      div.innerHTML = parseMarkdownBold(text); 
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    let loadingBubble = null;
    function showLoadingIndicator() {
      loadingBubble = document.createElement('div');
      loadingBubble.className = 'bubble bot bg-gray-800 text-gray-400 self-start rounded-bl-none animate-pulse';
      loadingBubble.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏¥‡∏î...';
      chatBox.appendChild(loadingBubble);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function hideLoadingIndicator() {
      if (loadingBubble) {
        chatBox.removeChild(loadingBubble);
        loadingBubble = null;
      }
    }

    function speak(text) {
      responsiveVoice.speak(text, "Thai Female");
    }

    async function sendMessage() {
      const userText = input.value.trim();
      if (!userText) return;

      appendBubble(userText, 'user');
      input.value = '';
      showLoadingIndicator();

      try {
        const chatHistory = [];
        chatHistory.push({ role: "user", parts: [{ text: userText }] });
        const payload = { contents: chatHistory };
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const result = await response.json();
        hideLoadingIndicator();

        if (result.candidates && result.candidates.length > 0 &&
            result.candidates[0].content && result.candidates[0].content.parts &&
            result.candidates[0].content.parts.length > 0) {
          const botReply = result.candidates[0].content.parts[0].text;
          appendBubble(botReply, 'bot');
          speak(botReply);
        } else {
          appendBubble("‡πÇ‡∏≠‡πä‡∏∞! ‡∏ï‡∏≠‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞‡∏Ñ‡∏∞!", 'bot');
        }
      } catch (error) {
        hideLoadingIndicator();
        appendBubble("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á", 'bot');
        console.error("Error:", error);
      }
    }

    input.addEventListener('keypress', function(event) {
      if (event.key === 'Enter') {
        sendMessage();
      }
    });
  </script>
</body>
</html>
